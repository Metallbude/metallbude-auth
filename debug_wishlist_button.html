<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metallbude Wishlist Button Debug Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .product-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #333;
        }
        
        .product-image {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .product-price {
            font-size: 20px;
            font-weight: 600;
            color: #000;
            margin-bottom: 16px;
        }
        
        .product-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .option-group {
            margin-bottom: 16px;
        }
        
        .option-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .option-select {
            width: 100%;
            max-width: 250px;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .button-container {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-top: 20px;
        }
        
        .add-to-cart-btn {
            background: #000;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .add-to-cart-btn:hover {
            background: #333;
        }
        
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
        }
        
        .debug-title {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 14px;
            color: #333;
        }
        
        .debug-log {
            background: #000;
            color: #0f0;
            padding: 12px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 12px;
        }
        
        .test-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ok { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
    </style>
</head>
<body>
    <h1>üî• Metallbude Wishlist Button Debug Test</h1>
    
    <!-- Inject customer ID for testing -->
    <script data-customer-id="4088060379300"></script>
    
    <div class="test-container">
        <h2 class="product-title">BEISTELLTISCH CIRO Test</h2>
        <img src="https://cdn.shopify.com/s/files/1/0483/4374/4676/files/runder-Beistelltisch-Metall-green-1.jpg?v=1744813142" 
             alt="BEISTELLTISCH CIRO" class="product-image">
        <div class="product-price">‚Ç¨250,00</div>
        
        <form action="/cart/add" method="post" class="product-form">
            <div class="option-group">
                <label class="option-label">Farbe:</label>
                <select name="id" class="option-select variant-selector" data-option-name="Farbe">
                    <option value="54202562511116" data-option-value="Matcha Latte">Matcha Latte (Known in wishlist)</option>
                    <option value="54202562543884" data-option-value="Navy Blue">Navy Blue</option>
                    <option value="54202562576652" data-option-value="Coral Pink">Coral Pink</option>
                </select>
            </div>
            
            <div class="button-container">
                <button type="submit" class="add-to-cart-btn">In den Warenkorb</button>
                
                <button type="button" class="metallbude-wishlist-btn"
                        data-product-id="11569167335692"
                        data-product-title="BEISTELLTISCH CIRO"
                        data-product-handle="beistelltisch-ciro">
                    <span class="wishlist-icon">ü§ç</span>
                    <span class="wishlist-text">Zur Wunschliste</span>
                </button>
            </div>
        </form>
    </div>
    
    <div class="test-container">
        <h2 class="product-title">BEISTELLTISCH COSMO Test</h2>
        <img src="https://cdn.shopify.com/s/files/1/0483/4374/4676/files/Beistelltisch_Produkt_Bunt_Cosmo-1.jpg?v=1743777303" 
             alt="BEISTELLTISCH COSMO" class="product-image">
        <div class="product-price">‚Ç¨295,00</div>
        
        <form action="/cart/add" method="post" class="product-form">
            <div class="option-group">
                <label class="option-label">Farbe:</label>
                <select name="id" class="option-select variant-selector" data-option-name="Farbe">
                    <option value="54186894328076" data-option-value="Blueberry Soda">Blueberry Soda (Known in wishlist)</option>
                    <option value="54186894360844" data-option-value="Sunset Orange">Sunset Orange</option>
                    <option value="54186894393612" data-option-value="Forest Green">Forest Green</option>
                </select>
            </div>
            
            <div class="button-container">
                <button type="submit" class="add-to-cart-btn">In den Warenkorb</button>
                
                <button type="button" class="metallbude-wishlist-btn"
                        data-product-id="8480628637964"
                        data-product-title="BEISTELLTISCH COSMO"
                        data-product-handle="beistelltisch-cosmo">
                    <span class="wishlist-icon">ü§ç</span>
                    <span class="wishlist-text">Zur Wunschliste</span>
                </button>
            </div>
        </form>
    </div>
    
    <div class="debug-panel">
        <div class="debug-title">üîß Debug Information</div>
        
        <div style="margin-bottom: 12px;">
            <div><span class="status-indicator" id="backend-status"></span><strong>Backend Connection:</strong> <span id="backend-status-text">Checking...</span></div>
            <div><span class="status-indicator" id="wishlist-status"></span><strong>Wishlist Service:</strong> <span id="wishlist-status-text">Initializing...</span></div>
            <div><span class="status-indicator" id="customer-status"></span><strong>Customer ID:</strong> <span id="customer-id-text">Loading...</span></div>
        </div>
        
        <div class="test-buttons">
            <button class="test-btn" onclick="testBackendConnection()">Test Backend</button>
            <button class="test-btn" onclick="testGetWishlist()">Get Wishlist</button>
            <button class="test-btn" onclick="testAddItem()">Test Add Item</button>
            <button class="test-btn" onclick="testRemoveItem()">Test Remove Item</button>
            <button class="test-btn" onclick="clearLog()">Clear Log</button>
        </div>
        
        <div class="debug-log" id="debug-log">
üî• Metallbude Wishlist Debug Console
=====================================
Initializing...
        </div>
    </div>
    
    <!-- Include the wishlist button script -->
    <script src="assets/wishlist-button.js"></script>
    
    <script>
        // Debug console
        const debugLog = document.getElementById('debug-log');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : 'üîç';
            const logEntry = `${timestamp} ${prefix} ${message}\n`;
            debugLog.textContent += logEntry;
            debugLog.scrollTop = debugLog.scrollHeight;
            
            // Also log to real console
            if (type === 'error') {
                originalConsoleError(message);
            } else {
                originalConsoleLog(message);
            }
        }
        
        // Override console methods to capture logs
        console.log = function(...args) {
            log(args.join(' '));
            originalConsoleLog.apply(console, args);
        };
        
        console.error = function(...args) {
            log(args.join(' '), 'error');
            originalConsoleError.apply(console, args);
        };
        
        function clearLog() {
            debugLog.textContent = 'üî• Metallbude Wishlist Debug Console\n=====================================\n';
        }
        
        // Test functions
        async function testBackendConnection() {
            log('Testing backend connection...');
            try {
                const response = await fetch('http://localhost:3000/health');
                const data = await response.json();
                log(`‚úÖ Backend connected: ${data.status}`);
                document.getElementById('backend-status').className = 'status-indicator status-ok';
                document.getElementById('backend-status-text').textContent = 'Connected';
            } catch (error) {
                log(`‚ùå Backend connection failed: ${error.message}`, 'error');
                document.getElementById('backend-status').className = 'status-indicator status-error';
                document.getElementById('backend-status-text').textContent = 'Failed';
            }
        }
        
        async function testGetWishlist() {
            log('Testing get wishlist...');
            const customerId = window.metallbudeWishlist?.customerId || '4088060379300';
            try {
                const response = await fetch(`http://localhost:3000/api/public/wishlist/items?customerId=${customerId}`);
                const data = await response.json();
                log(`üì• Wishlist items: ${data.count} items found`);
                data.items.forEach((item, index) => {
                    log(`   Item ${index + 1}: ${item.title} (${item.selectedOptions?.Farbe || 'No color'})`);
                });
            } catch (error) {
                log(`‚ùå Get wishlist failed: ${error.message}`, 'error');
            }
        }
        
        async function testAddItem() {
            log('Testing add item...');
            const customerId = window.metallbudeWishlist?.customerId || '4088060379300';
            try {
                const response = await fetch('http://localhost:3000/api/public/wishlist/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customerId: customerId,
                        productId: 'gid://shopify/Product/12345',
                        variantId: 'gid://shopify/ProductVariant/67890',
                        title: 'Test Product Debug',
                        selectedOptions: { 'Color': 'Test Blue' }
                    })
                });
                const data = await response.json();
                log(`‚ûï Add result: ${data.success ? 'Success' : 'Failed'} - ${data.message}`);
            } catch (error) {
                log(`‚ùå Add item failed: ${error.message}`, 'error');
            }
        }
        
        async function testRemoveItem() {
            log('Testing remove item...');
            const customerId = window.metallbudeWishlist?.customerId || '4088060379300';
            try {
                const response = await fetch('http://localhost:3000/api/public/wishlist/remove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customerId: customerId,
                        productId: 'gid://shopify/Product/12345',
                        variantId: 'gid://shopify/ProductVariant/67890',
                        selectedOptions: { 'Color': 'Test Blue' }
                    })
                });
                const data = await response.json();
                log(`‚ûñ Remove result: ${data.success ? 'Success' : 'Failed'} - ${data.message}`);
            } catch (error) {
                log(`‚ùå Remove item failed: ${error.message}`, 'error');
            }
        }
        
        // Status updates
        function updateStatus() {
            if (window.metallbudeWishlist) {
                document.getElementById('wishlist-status').className = 'status-indicator status-ok';
                document.getElementById('wishlist-status-text').textContent = 'Initialized';
                document.getElementById('customer-status').className = 'status-indicator status-ok';
                document.getElementById('customer-id-text').textContent = window.metallbudeWishlist.customerId;
            } else {
                document.getElementById('wishlist-status').className = 'status-indicator status-warning';
                document.getElementById('wishlist-status-text').textContent = 'Not initialized';
                document.getElementById('customer-status').className = 'status-indicator status-warning';
                document.getElementById('customer-id-text').textContent = 'Unknown';
            }
        }
        
        // Auto-run tests
        window.addEventListener('load', () => {
            setTimeout(() => {
                updateStatus();
                testBackendConnection();
                testGetWishlist();
            }, 1000);
        });
        
        setInterval(updateStatus, 2000);
        
        // Mock product variants for testing
        window.productVariants = [
            {
                id: 54202562511116,
                price: 25000, // In cents
                sku: "1001307",
                featured_image: {
                    url: "https://cdn.shopify.com/s/files/1/0483/4374/4676/files/runder-Beistelltisch-Metall-green-1.jpg"
                }
            },
            {
                id: 54202562543884,
                price: 25000,
                sku: "1001308",
                featured_image: {
                    url: "https://cdn.shopify.com/s/files/1/0483/4374/4676/files/runder-Beistelltisch-Metall-blue-1.jpg"
                }
            },
            {
                id: 54186894328076,
                price: 29500,
                sku: "1001324",
                featured_image: {
                    url: "https://cdn.shopify.com/s/files/1/0483/4374/4676/files/Beistelltisch_Produkt_Bunt_Cosmo-1.jpg"
                }
            }
        ];
        
        log('Debug page loaded successfully');
    </script>
</body>
</html>
